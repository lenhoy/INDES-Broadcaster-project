<Page
    x:Class="OBSUWP.MainPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:OBSUWP"
    xmlns:localDataClasses="using:OBSUWP.DataClasses"
    xmlns:locControls="using:OBSUWP.Controls"
    xmlns:localInterface="using:OBSUWP.Inferfaces"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    d:DataContext="{d:DesignInstance Type=local:MainPageViewModel}"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Page.Resources>
        <DataTemplate x:Name="sceneGridTemplate" x:DataType="localDataClasses:Scene">
            <locControls:SceneRenderer InputScene="{x:Bind Self, Mode=OneWay}"
                                       Width="240" Height="135">
            </locControls:SceneRenderer>
        </DataTemplate>
    </Page.Resources>

    <Grid BorderBrush="Transparent" BorderThickness="2" Padding="12" >
        <!--#region Grid Definitions -->
        <Grid.ColumnDefinitions>
            <ColumnDefinition />
            <ColumnDefinition />
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition />
            <RowDefinition />
        </Grid.RowDefinitions>
        <!--#endregion-->

        <GridView Grid.Column="0" Grid.Row="1"
                  Margin="10 20 0 0"
                  ItemsSource="{x:Bind VM.Scenes}"
                  ItemTemplate="{StaticResource sceneGridTemplate}"
                  SelectionMode="None"
                  IsItemClickEnabled="True"
                  ItemClick="GridView_ItemClick">
        </GridView>

        <!-- Live View -->
        <locControls:SceneRenderer x:Name="liveView" Grid.Column="1" Grid.Row="0"
                                   InputScene="{x:Bind VM.LiveScene, Mode=OneWay}">
        </locControls:SceneRenderer>
        
        <!-- Preview window -->
        <Grid Grid.Row="0" Grid.Column="0"
              BorderBrush="Transparent" BorderThickness="2">
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="60" />
            </Grid.RowDefinitions>

            <locControls:SceneRenderer x:Name="preView" Grid.Row="0"
                                       InputScene="{x:Bind VM.PreviewScene, Mode=OneWay}"
                                       AreTransportControlsVisible="true"
                                       IsMuted="false">
            </locControls:SceneRenderer>

            <StackPanel Grid.Row="1" Orientation="Horizontal"
                        Margin="5"
                        CornerRadius="10" RequestedTheme="Default" 
                        Background="{ThemeResource SystemControlBackgroundBaseLowBrush}"
                        >
                <AppBarButton Width="35" Height="35"
                              VerticalAlignment="Center"
                              Margin="5 0 10 0"
                              CornerRadius="25"
                              Background="DarkRed"
                              >
                    <AppBarButton.Flyout>
                        <MenuFlyout>
                            <MenuFlyoutItem Text="Local File" 
                                            Click="MenuFlyoutItem_Click"
                                            Tag="localFile"/>
                            <MenuFlyoutItem Text="Local Camera" 
                                            Click="MenuFlyoutItem_Click"
                                            Tag="localCamera"/>
                            <MenuFlyoutSeparator />
                            <MenuFlyoutItem Text="Online Stream" 
                                            Click="MenuFlyoutItem_Click"
                                            Tag="onlineStream"/>
                            <MenuFlyoutItem Text="IP Camera" 
                                            Click="MenuFlyoutItem_Click"
                                            Tag="ipCamera"/>
                        </MenuFlyout>
                    </AppBarButton.Flyout>
                </AppBarButton>
                <Button Style="{StaticResource ButtonRevealStyle}" Height="30" MinWidth="70"
                        Content="{  x:Bind VM.PreviewScene.Sources[0].Type,
                                    Mode=OneWay, 
                                    FallbackValue='Select a scene'
                        }">
                    <Button.Flyout>
                        <Flyout>
                            <StackPanel>
                                <TextBlock Style="{ThemeResource BaseTextBlockStyle}" 
                                           Text="Sure you wan't to delete source?" />
                                <Button Content="Remove"
                                        Command="{x:Bind VM.RemoveSourceFromPreviewSceneCommand}"
                                        CommandParameter="{x:Bind VM.PreviewScene.Sources[0]}" />
                            </StackPanel>
                        </Flyout>
                    </Button.Flyout>
                </Button>
            </StackPanel>
            
        </Grid>
        
        <!-- Text and such for debugging purposes TODO remove-->
        <TextBlock Grid.Row="1" Grid.Column="1"
                   Text="{x:Bind VM.PreviewScene.Sources[0].Type, 
                            Mode=OneWay,
                            FallbackValue='Select a scene'}"></TextBlock>
        
    </Grid>
</Page>
